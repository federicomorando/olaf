<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>Olaf Linked Authority File</title>

  <!-- CSS  -->
  <link href="/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="/css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="/css/loader.css" type="text/css" rel="stylesheet" >
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <style>
    body {
      height:100%;
      min-height:100%;
    }
    .card .card-content {
      padding-top: 0px;
      padding-bottom: 0px;
    }
    .card .card-action {
      padding-top: 0px;
      padding-bottom: 0px;
    }
    .card.horizontal .card-image img {
      max-height: 282px;
    }
    .row {
      margin-bottom: 0px;
    }
    #loader-wrapper {
      position: fixed;
      height: 100%;
      width: 100%;
      top:0;
      left: 0;
      z-index:9999;
      background-color: rgba(255, 255, 255, 0.7);
    }
  </style>
</head>
<body>
  <div id="loader-wrapper">
    <div id="loader"></div>
  </div>

  <nav class="light-blue lighten-1" role="navigation">
    <div class="nav-wrapper container">
      <a id="logo-container" href="/" class="brand-logo">
        Olaf Linked Authority File
      </a>
    </div>
  </nav>

  <div class="container">
    <div class="section">
      <div class="row">
        <div class="col s12 m8">
          <div class="input-field col s12">
            <input id="mySearch" type="text" class="validate">
            <label for="mySearch">Search</label>
          </div>
        </div>
        <div class="col s12 m4">
          <div class="input-field col s12">
            <a class="waves-effect waves-light btn" onclick="generate()">Cerca!</a>
          </div>
        </div>
      </div>
      <div id="result"></div>
    </div>
  </div>

  <footer class="page-footer light-blue lighten-1">
    <div class="footer-copyright">
      <div class="container" align="center">
        Made with ‚ù§ and <b>linked data</b> by <a href="https://synapta.it/"><img src="img/synapta-logo-h.svg" height="23px" style="vertical-align: text-bottom;"/></a>
      </div>
    </div>
  </footer>


  <!--  Scripts-->
  <script src="/js/jquery-2.1.1.min.js"></script>
  <script src="/js/materialize.js"></script>
  <script src="/js/init.js"></script>
  <script>
  hashCode = function(s){
   return s.split("").reduce(function(a,b){a=((a<<5)-a)+b.charCodeAt(0);return a&a},0);
  }

    var genAbs = function (wikiname) {
      $.getJSON('/dbpedia/abstract/' + wikiname, function(data) {
        if (data.abstract !== false) {
          $("#abstract-info"+hashCode(wikiname)).html('<p><span class="activator">espandi abstract <i class="fa fa-caret-down" aria-hidden="true"></i></span></p><br/>');
          $("#abstract"+hashCode(wikiname)).html(data.abstract);
        }
      });
    }

    var generate = function () {
      $('body').removeClass('loaded');

      $.getJSON('/search/' + $("#mySearch").val(), function(data) {
        if (data["no-results"] !== undefined) {
            $("#result").html("Nessun risultato!");
            $('body').addClass('loaded');
            return;
        }

        data.hints.sort(function(a, b) {
            return parseFloat(a.index) - parseFloat(b.index);
        });

        if (data.retry === true) {
            generate();
            return;
        }

        var cards = "";
        for (var i = 0; i < data.hints.length; i++) {
            if (i === 0 || i % 2 === 0) {
                cards += '<div class="row">';
            }
            cards += '<div class="col s12 m6"><div class="card horizontal"><div class="card-image">'
            if (data.hints[i].immagine) {
                cards += '<img src="' + data.hints[i].immagine.value + '">'
            } else {
                cards += '<img src="">'
            }
            cards += '</div><div class="card-stacked"><div class="card-content">'
            if (data.hints[i].label)
            cards += '<h5>' + data.hints[i].label.value + '</h5>'
            if (data.hints[i].desc)
            cards += '<p>' + data.hints[i].desc.value + '</p>'
            cards += '<ul>'
            if (data.hints[i].birthDate) {
                var bdate = new Date(data.hints[i].birthDate.value);
                cards += '<li>Nascita: ' + bdate.getFullYear() + '-' + (bdate.getMonth()+1) + '-' + bdate.getDate();
            }
            if (data.hints[i].deathDate) {
                var ddate = new Date(data.hints[i].deathDate.value);
                cards += '<li>Morte: ' + ddate.getFullYear() + '-' + (ddate.getMonth()+1) + '-' + ddate.getDate();
            }
            cards += '</ul>'
            if (data.hints[i].itwiki) {
                var wikiname = data.hints[i].itwiki.value.replace("https://it.wikipedia.org/wiki/","").replace(/%20/g,"_");
                cards += '<p id="abstract-info'+hashCode(wikiname)+'"></p>'
            }
            cards += '</ul></div><div class="card-action">'
            cards += '<ul><li><a href="https://wikidata.org/wiki/' + data.hints[i].wikidata + '">Wikidata</a>'
            if (data.hints[i].itwiki) {
                cards += '<li><a href="' + data.hints[i].itwiki.value + '">Wikipedia in italiano</a>'
                genAbs(wikiname);
            }
            if (data.hints[i].enwiki)
            cards += '<li><a href="' + data.hints[i].enwiki.value + '">Wikipedia in inglese</a>'
            cards += '</ul></div></div>'
            cards += '<div class="card-reveal"><span class="card-title"><i class="fa fa-times right" aria-hidden="true"></i></span><p id="abstract'+hashCode(wikiname)+'"></p></div>'
            cards += '</div></div>'
            if (i % 2 === 1) {
                cards += '</div>';
            }
        }
        $("#result").html(cards);
        $('body').addClass('loaded');
      });
    }
    //generate();
    $('body').addClass('loaded');


    </script>

  </body>
</html>
